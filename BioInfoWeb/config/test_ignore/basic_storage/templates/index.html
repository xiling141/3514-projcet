<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿç‰©ä¿¡æ¯å­¦è½¯ä»¶ç›®å½•</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; }
        body { background: #f5f7fa; color: #333; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #3498db; padding-bottom: 15px; }
        .tree { list-style: none; padding-left: 0; }
        .tree ul { list-style: none; padding-left: 25px; margin: 8px 0; border-left: 1px dashed #ddd; display: none; } /* åˆå§‹éšè—ä¸‹çº§ */
        .tree li { margin: 10px 0; }
        .tree-category, .tree-subcategory { cursor: pointer; padding: 12px 15px; border-radius: 6px; transition: all 0.3s ease; display: flex; align-items: center; }
        .tree-category { background: #e8f4fc; border-left: 5px solid #3498db; font-weight: bold; margin-top: 15px; }
        .tree-category:hover { background: #d4eaf7; transform: translateX(3px); }
        .tree-subcategory { background: #f8f9fa; border-left: 3px solid #2ecc71; margin-left: 10px; }
        .tree-subcategory:hover { background: #e9f7ef; }
        .tree-item { padding: 10px 20px; background: #fff; border: 1px solid #eee; border-radius: 4px; margin: 5px 25px; color: #555; display: flex; align-items: center; }
        .tree-item:before { content: "â–¸"; margin-right: 10px; color: #95a5a6; }
        .toggle-icon { margin-right: 10px; transition: transform 0.2s; font-weight: bold; color: #7f8c8d; }
        .collapsed .toggle-icon { transform: rotate(0deg); }
        .expanded .toggle-icon { transform: rotate(90deg); }
        .loading, .error { text-align: center; padding: 40px; color: #7f8c8d; }
        .error { color: #e74c3c; }
        footer { text-align: center; margin-top: 30px; color: #95a5a6; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¬ ç”Ÿç‰©ä¿¡æ¯å­¦è½¯ä»¶ç›®å½•</h1>
        <div id="tree-container">
            <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>
        <footer>ç‚¹å‡»å¤§ç±»æˆ–å­ç±»å¯ä»¥å±•å¼€æˆ–æŠ˜å è¯¦ç»†ä¿¡æ¯</footer>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåï¼Œä»Flaskåç«¯è·å–æ•°æ®
        window.addEventListener('DOMContentLoaded', (event) => {
            fetch('/api/get_software_data')
                .then(response => {
                    if (!response.ok) { throw new Error('ç½‘ç»œå“åº”å¼‚å¸¸'); }
                    return response.json();
                })
                .then(data => { buildTree(data); })
                .catch(error => {
                    console.error('è·å–æ•°æ®å¤±è´¥:', error);
                    document.getElementById('tree-container').innerHTML = `<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥ç½‘ç»œã€‚</div>`;
                });
        });

        function buildTree(data) {
            const container = document.getElementById('tree-container');
            if (!data || Object.keys(data).length === 0) {
                container.innerHTML = '<div class="loading">æš‚æ— æ•°æ®</div>';
                return;
            }
            
            let html = '<ul class="tree">';
            // éå†ç¬¬ä¸€çº§ï¼šå¤§ç±»
            for (const [category, subcategories] of Object.entries(data)) {
                html += `
                    <li>
                        <div class="tree-category expanded" onclick="toggleList(this)">
                            <span class="toggle-icon">â–¸</span>
                            <strong>${category}</strong>
                        </div>
                        <ul>`; // è¿™é‡Œulåˆå§‹æ˜¯æ˜¾ç¤ºçš„ï¼Œé CSSçš„displayæ§åˆ¶
                // éå†ç¬¬äºŒçº§ï¼šå­ç±»
                for (const [subcategory, items] of Object.entries(subcategories)) {
                    html += `
                        <li>
                            <div class="tree-subcategory" onclick="toggleList(this)">
                                <span class="toggle-icon">â–¸</span>
                                ${subcategory}
                            </div>
                            <ul>`;
                    // éå†ç¬¬ä¸‰çº§ï¼šå…·ä½“è½¯ä»¶åç§°
                    items.forEach(item => {
                        html += `<li class="tree-item">${item}</li>`;
                    });
                    html += `</ul></li>`;
                }
                html += `</ul></li>`;
            }
            html += '</ul>';
            container.innerHTML = html;
        }

        // å±•å¼€/æŠ˜å åŠŸèƒ½
        function toggleList(element) {
            // åˆ‡æ¢å½“å‰ç‚¹å‡»å…ƒç´ çš„å±•å¼€/æŠ˜å ç±»å
            element.classList.toggle('expanded');
            element.classList.toggle('collapsed');
            // æ‰¾åˆ°ç´§æ¥ç€çš„ä¸‹ä¸€ä¸ªulå…ƒç´ ï¼ˆå³å­åˆ—è¡¨ï¼‰å¹¶åˆ‡æ¢å…¶æ˜¾ç¤ºçŠ¶æ€
            const subList = element.nextElementSibling;
            if (subList && subList.tagName === 'UL') {
                subList.style.display = subList.style.display === 'block' ? 'none' : 'block';
            }
        }
    </script>
</body>
</html>